<?php/** * CCNGaming, info about clan, stats etc * * @package NGamingCore */class CCNGaming extends CObject implements IController{	public function __construct()	{		parent::__construct();		$this->ranks = array(			'1'		=> 'Master Über Clanleader',		);				$this->views->AddView('ngaming/featured-first.tpl.php', array('ranks'=>$this->ranks), 'featured-first');				$this->views->AddView('ngaming/featured-last.tpl.php', array(), 'featured-last');	}		/**	 * The index page	 *	 *	 */	 	public function Index($rank=null)	{		$model = new CMNGaming();		$this->views->SetTitle('NGaming - The killer clan');		$this->views->AddView('ngaming/index.tpl.php', array(			'members'	=> $model->ReadAll($rank),			'ranks'		=> $this->ranks,			),			'primary');		$this->views->AddView('ngaming/index.sidebar.tpl.php', array(), 'sidebar');	}	 	public function EditStats($id)	{		$model = new CMNGaming();		$stats = $model->ReadStats($id);				$form = new CForm();				$form->AddElement(new CFormElementText('nick', array('value' => $stats['nick'])));		$form->AddElement(new CFormElementText('rank', array('value' => $stats['rank'])));		$form->AddElement(new CFormElementText('kills', array('value' => $stats['kills'])));		$form->AddElement(new CFormElementText('deaths', array('value' => $stats['deaths'])));		$form->AddElement(new CFormElementSubmit('save', array('callback' => array($this, 'DoSaveStats'))));		$form->AddElement(new CFormElementHidden('id', array('value' => $stats['id'])));				$form->Check();				$this->views->SetTitle('NGaming - The killer clan');		$this->views->AddView('ngaming/editstats.tpl.php', array(				'form'	=> $form->GetHTML(),			),			'primary');		$this->views->AddView('ngaming/index.sidebar.tpl.php', array(), 'sidebar');	}	 	public function DoSaveStats($form)	{		$model = new CMNGaming();		$id		= $form['id']['value'];		$nick	= $form['nick']['value'];		$rank	= $form['rank']['value'];		$kills	= $form['kills']['value'];		$deaths	= $form['deaths']['value'];		if ($model->ChangeStats($id, $nick, $rank, $kills, $deaths))		{			$this->session->AddMessage('success', 'Stats saved succesfully.');		}		else		{			$this->session->AddMessage('error', 'Unable to save stats.');		}		$this->RedirectToController('index');	}		public function AddStats()	{		$model = new CMNGaming();		$form = new CForm();				$form->AddElement(new CFormElementSelect('acronym', array('options' => $model->GetAllUsers())));		$form->AddElement(new CFormElementText('nick', array()));		$form->AddElement(new CFormElementText('rank', array()));		$form->AddElement(new CFormElementText('kills', array()));		$form->AddElement(new CFormElementText('deaths', array()));		$form->AddElement(new CFormElementSubmit('save', array('callback' => array($this, 'DoAddStats'))));				$form->Check();				$this->views->SetTitle('NGaming - The killer clan');		$this->views->AddView('ngaming/addstats.tpl.php', array(				'form'	=> $form->GetHTML(),			),			'primary');		$this->views->AddView('ngaming/index.sidebar.tpl.php', array(), 'sidebar');	}	 	public function DoAddStats($form)	{		$model = new CMNGaming();		$id		= $form['id']['value'];		$nick	= $form['nick']['value'];		$rank	= $form['rank']['value'];		$kills	= $form['kills']['value'];		$deaths	= $form['deaths']['value'];		if ($model->AddStats($id, $nick, $rank, $kills, $deaths))		{			$this->session->AddMessage('success', 'Stats added succesfully.');		}		else		{			$this->session->AddMessage('error', 'Unable to add stats.');		}		$this->RedirectToController('index');	}}